{"version":3,"sources":["../src/memory_record.js"],"names":["MemoryRecord","key","values","values_map","element","lookup","Error","name","keys","codes","join","_values_map","_","reduce","define","a","e","i","code","_keys","_codes","map","_values","attributes","Object","defineProperty","value","writable","enumerable","configurable","forIn","k","hasOwnProperty","toString","process","argv","__filename","Foo","record","console","log","v","fetch"],"mappings":"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","file":"memory_record.js","sourcesContent":["// Example.\n//\n//   import { MemoryRecord } from \"./memory_record\"\n//\n//   class Foo extends MemoryRecord {\n//     static get define() {\n//       return [\n//         { key: \"black\", name: '☗', },\n//         { key: \"white\", name: '☖', },\n//       ]\n//     }\n//\n//     get flip() {\n//       return Foo.values[(this.code + 1) % Foo.values.length]\n//     }\n//   }\n//\n//   Foo.lookup(\"black\").key           // => \"black\"\n//   Foo.lookup(1).key                 // => \"white\"\n//   Foo.values[0] === Foo.values[0]   // => true\n//\n\nimport _ from \"lodash\"\n\nclass MemoryRecord {\n  static get define() {\n    throw new Error(`${this.name}.define() is not implemented`)\n  }\n\n  static lookup(key) {\n    if (key instanceof this) {\n      return key\n    }\n    if (typeof key === \"number\") {\n      return this.values[key]\n    } else {\n      return this.values_map[key]\n    }\n  }\n\n  static fetch(key) {\n    const element = this.lookup(key)\n    if (!element) {\n      throw new Error([\n        `${this.name}.fetch(${JSON.stringify(key)}) does not match anything`,\n        `keys: ${JSON.stringify(this.keys)}`,\n        `codes: ${JSON.stringify(this.codes)}`,\n      ].join(\"\\n\"))\n    }\n    return element\n  }\n\n  static get values_map() {\n    this._values_map = this._values_map || _.reduce(this.define, (a, e, i) => { // http://devdocs.io/lodash~4/index#reduce\n      a[e.key] = Object.freeze(new this(Object.assign({}, e, {code: i})))\n      return a\n    }, {})\n    return this._values_map\n  }\n\n  static get keys() {\n    this._keys = this._keys || Object.keys(this.values_map)\n    return this._keys\n  }\n\n  static get codes() {\n    this._codes = this._codes || this.values.map(e => e.code)\n    return this._codes\n  }\n\n  static get values() {\n    this._values = this._values || Object.values(this.values_map)\n    return this._values\n  }\n\n  constructor(attributes) {\n    Object.defineProperty(this, \"attributes\", {value: attributes, writable: false, enumerable: false, configurable: false})\n\n    _.forIn(attributes, (e, k) => {\n      Object.defineProperty(this, k, {value: e, writable: false, enumerable: true, configurable: false})\n    })\n\n    if (!this.hasOwnProperty(\"name\")) {\n      Object.defineProperty(this, \"name\", {value: attributes.name || this.key.toString(), writable: false, enumerable: true, configurable: false})\n    }\n  }\n}\n\nexport { MemoryRecord }\n\nif (process.argv[1] === __filename) {\n  class Foo extends MemoryRecord {\n    static get define() {\n      return [\n        { key: \"black\", name: '☗', },\n        { key: \"white\", name: '☖', },\n      ]\n    }\n  }\n\n  const record = Foo.values[0]\n  console.log(record.key)\n  console.log(record.code)\n  console.log(record.name)\n\n  console.log(Foo.values)\n  console.log(Foo.lookup(\"black\").name)\n  console.log(Foo.lookup(\"black\").code)\n\n  let v = Foo.lookup(\"black\")\n  console.log(v instanceof Foo)\n\n  console.log(Foo.lookup(0))\n  console.log(Foo.lookup(1))\n  console.log(Foo.lookup(2))\n\n  console.log(Foo.values[0] === Foo.values[0])\n\n  console.log(Foo.values.map(e => e.key))\n  console.log(Object.keys(Foo.values_map))\n  console.log(Foo.fetch('unknown'))\n}\n"]}