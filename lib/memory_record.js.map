{"version":3,"sources":["../src/memory_record.js"],"names":["MemoryRecord","key","values","values_map","element","lookup","Error","name","keys","codes","join","console","warn","_values_map","_","reduce","define","a","e","i","code","_keys","_codes","map","_values","attributes","toString","process","argv","__filename","log","v","fetch"],"mappings":"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","file":"memory_record.js","sourcesContent":["// Example.\n//\n//   import { MemoryRecord } from \"./memory_record\"\n//\n//   class Foo extends MemoryRecord {\n//     static get define() {\n//       return [\n//         { key: \"black\", name: '☗', },\n//         { key: \"white\", name: '☖', },\n//       ]\n//     }\n//\n//     get flip() {\n//       return Foo.values[(this.code + 1) % Foo.values.length]\n//     }\n//   }\n//\n//   Foo.lookup(\"black\").key           // => \"black\"\n//   Foo.lookup(1).key                 // => \"white\"\n//   Foo.values[0] === Foo.values[0]   // => true\n//\n\nimport _ from \"lodash\"\n\nclass MemoryRecord {\n  static get define() {\n    console.warn(\"not implemented\")\n\n    return [\n      { key: \"(key_x)\", },\n      { key: \"(key_y)\", },\n    ]\n  }\n\n  static lookup(key) {\n    if (key instanceof this) {\n      return key\n    }\n    if (typeof key === \"number\") {\n      return this.values[key]\n    } else {\n      return this.values_map[key]\n    }\n  }\n\n  static fetch(key) {\n    const element = this.lookup(key)\n    if (!element) {\n      throw new Error([\n        `${this.name}.fetch(${JSON.stringify(key)}) does not match anything`,\n        `keys: ${JSON.stringify(this.keys)}`,\n        `codes: ${JSON.stringify(this.codes)}`,\n      ].join(\"\\n\"))\n    }\n    return element\n  }\n\n  static get values_map() {\n    this._values_map = this._values_map || _.reduce(this.define, (a, e, i) => { // http://devdocs.io/lodash~4/index#reduce\n      a[e.key] = Object.freeze(new this(Object.assign({}, e, {code: i})))\n      return a\n    }, {})\n    return this._values_map\n  }\n\n  static get keys() {\n    this._keys = this._keys || Object.keys(this.values_map)\n    return this._keys\n  }\n\n  static get codes() {\n    this._codes = this._codes || this.values.map(e => e.code)\n    return this._codes\n  }\n\n  static get values() {\n    this._values = this._values || Object.values(this.values_map)\n    return this._values\n  }\n\n  constructor(attributes) {\n    this.attributes = attributes\n  }\n\n  get key() {\n    return this.attributes.key\n  }\n\n  get name() {\n    return this.attributes.name || this.key.toString()\n  }\n\n  get code() {\n    return this.attributes.code\n  }\n}\n\nexport { MemoryRecord }\n\nif (process.argv[1] === __filename) {\n  console.log(MemoryRecord.values)\n  console.log(MemoryRecord.lookup(\"(key_x)\").name)\n  console.log(MemoryRecord.lookup(\"(key_x)\").code)\n\n  let v = MemoryRecord.lookup(\"(key_x)\")\n  console.log(v instanceof MemoryRecord)\n\n  console.log(MemoryRecord.lookup(0))\n  console.log(MemoryRecord.lookup(1))\n  console.log(MemoryRecord.lookup(2))\n\n  console.log(MemoryRecord.values[0] === MemoryRecord.values[0])\n\n  console.log(MemoryRecord.values.map(e => e.key))\n  console.log(Object.keys(MemoryRecord.values_map))\n  console.log(MemoryRecord.fetch('unknown'))\n}\n"]}