{"version":3,"sources":["../src/memory_record.js"],"names":["MemoryRecord","key","codes_hash","keys_hash","element","lookup","Error","name","keys","codes","join","_values","_","map","define","e","i","index","code","_keys_hash","reduce","values","a","_codes_hash","_keys","_codes","_names","attributes","Object","defineProperty","value","writable","enumerable","configurable","forIn","k","toString","process","argv","__filename","Foo","console","log","record","v","fetch"],"mappings":"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","file":"memory_record.js","sourcesContent":["// Example.\n//\n//   import MemoryRecord from \"./memory_record\"\n//\n//   class Foo extends MemoryRecord {\n//     static get define() {\n//       return [\n//         { key: \"black\", name: '☗', },\n//         { key: \"white\", name: '☖', },\n//       ]\n//     }\n//\n//     get flip() {\n//       return Foo.values[(this.code + 1) % Foo.values.length]\n//     }\n//   }\n//\n//   Foo.lookup(\"black\").key           // => \"black\"\n//   Foo.lookup(1).key                 // => \"white\"\n//   Foo.values[0] === Foo.values[0]   // => true\n//\n\nimport _ from \"lodash\"\n\nexport default class MemoryRecord {\n  static get define() {\n    throw new Error(`${this.name}.define() is not implemented`)\n  }\n\n  static lookup(key) {\n    if (key instanceof this) {\n      return key\n    }\n    if (typeof key === \"number\") {\n      return this.codes_hash[key]\n    } else {\n      return this.keys_hash[key]\n    }\n  }\n\n  static fetch(key) {\n    const element = this.lookup(key)\n    if (!element) {\n      throw new Error([\n        `${this.name}.fetch(${JSON.stringify(key)}) does not match anything`,\n        `keys: ${JSON.stringify(this.keys)}`,\n        `codes: ${JSON.stringify(this.codes)}`,\n      ].join(\"\\n\"))\n    }\n    return element\n  }\n\n  static get values() {\n    return this._values || _.map(this.define, (e, i) => {\n      e = Object.assign({}, e, {index: i})\n      if (!(\"code\" in e)) {\n        e = Object.assign({}, e, {code: i})\n      }\n      if (!(\"key\" in e)) {\n        e = Object.assign({}, e, {key: `_key${i}`})\n      }\n      return Object.freeze(new this(e))\n    })\n  }\n\n  static get keys_hash() {\n    this._keys_hash = this._keys_hash || _.reduce(this.values, (a, e) => { // http://devdocs.io/lodash~4/index#reduce\n      if (e.key in a) {\n        throw new Error([\n          `${this.name}#key ${JSON.stringify(e.key)} is duplicate`,\n          `Existing: ${JSON.stringify(Object.keys(a))}`,\n          `Conflict: ${JSON.stringify(e)}`,\n        ].join(\"\\n\"))\n      }\n      a[e.key] = e\n      return a\n    }, {})\n    return this._keys_hash\n  }\n\n  static get codes_hash() {\n    this._codes_hash = this._codes_hash || _.reduce(this.values, (a, e) => { // http://devdocs.io/lodash~4/index#reduce\n      if (e.code in a) {\n        throw new Error([\n          `${this.name}#code ${JSON.stringify(e.code)} is duplicate`,\n          `Existing: ${JSON.stringify(Object.keys(a))}`,\n          `Conflict: ${JSON.stringify(e)}`,\n        ].join(\"\\n\"))\n      }\n      a[e.code] = e\n      return a\n    }, {})\n    return this._codes_hash\n  }\n\n  static get keys() {\n    this._keys = this._keys || Object.keys(this.keys_hash)\n    return this._keys\n  }\n\n  static get codes() {\n    // In case of Object.keys(this.codes_hash) code becomes a character string\n    this._codes = this._codes || this.values.map(e => e.code)\n    return this._codes\n  }\n\n  static get names() {\n    this._names = this._names || this.values.map(e => e.name)\n    return this._names\n  }\n\n  constructor(attributes) {\n    Object.defineProperty(this, \"attributes\", {value: attributes, writable: false, enumerable: false, configurable: false})\n\n    _.forIn(attributes, (e, k) => {\n      Object.defineProperty(this, k, {value: e, writable: false, enumerable: true, configurable: false})\n    })\n\n    // If name is not defined, it returns string converted from key\n    // In the case of this.hasOwnProperty (\"name\") see parents. Parents also look at in.\n    if (!(\"name\" in this)) {\n      Object.defineProperty(this, \"name\", {value: attributes.name || attributes.key.toString(), writable: false, enumerable: true, configurable: false})\n    }\n  }\n}\n\nif (process.argv[1] === __filename) {\n  class Foo extends MemoryRecord {\n    static get define() {\n      return [\n        { key: \"black\", name: '☗', },\n        { key: \"white\", name: '☖', },\n        { code: 7, },\n      ]\n    }\n  }\n\n  console.log(Foo.keys)\n  console.log(Foo.codes)\n\n  const record = Foo.values[0]\n  console.log(record.key)\n  console.log(record.code)\n  console.log(record.name)\n\n  console.log(Foo.values)\n  console.log(Foo.lookup(\"black\").name)\n  console.log(Foo.lookup(\"black\").code)\n\n  console.log(Foo.lookup(\"_key2\").name)\n\n  let v = Foo.lookup(\"black\")\n  console.log(v instanceof Foo)\n\n  console.log(Foo.lookup(0))\n  console.log(Foo.lookup(1))\n  console.log(Foo.lookup(2))\n\n  console.log(Foo.values[0] === Foo.values[0])\n\n  console.log(Foo.values.map(e => e.key))\n  console.log(Object.keys(Foo.keys_hash))\n  console.log(Foo.fetch('unknown'))\n}\n"]}